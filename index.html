<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ConexiÃ³n Viva ðŸ’–</title>
<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
</head>

<body style="text-align:center; font-family:Arial; background:#fff0f5;">

<h2>ðŸ’Œ ConexiÃ³n Viva</h2>

<p><b>Mensaje de Kevin:</b></p>
<p id="mensaje">Esperando...</p>
<p id="color"></p>

<hr>

<button onclick="send('latido')">ðŸ’“ Latido</button><br><br>
<button onclick="send('servo')">ðŸ¤— Abrazo (servo)</button><br><br>
<button onclick="send('arcoiris')">ðŸŒˆ ArcoÃ­ris</button><br><br>
<button onclick="send('buzzer')">ðŸ”” PiÃ©nsame</button>

<script>
const client = mqtt.connect("wss://test.mosquitto.org:8081");

client.on("connect", () => {
  console.log("Web conectada a MQTT");
  client.subscribe("conexion/esp32/kevin");
});

client.on("message", (topic, message) => {
  try {
    // ðŸ”‘ CONVERTIR A STRING
    const data = JSON.parse(message.toString());

    document.getElementById("mensaje").innerText =
      data.mensaje || "Sin mensaje";

    document.getElementById("color").innerText =
      "Color: " + (data.color || "desconocido");

    console.log("Actualizado:", data);
  } catch (e) {
    console.error("Error JSON:", e);
  }
});

// ðŸ”‘ FUNCIÃ“N QUE FALTABA
function send(accion) {
  client.publish(
    "conexion/web/ella",
    JSON.stringify({ accion: accion })
  );
}
</script>

</body>
</html>


